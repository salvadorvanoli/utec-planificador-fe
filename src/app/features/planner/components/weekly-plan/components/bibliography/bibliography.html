<div class="bibliography-container">
  <div class="mb-4">
    <!-- Title with hover button -->
    <div class="flex items-center gap-2 mb-4 group">
      <h3 class="text-lg font-semibold">Bibliografía</h3>
      @if (!isAdding() && !isReadOnly()) {
        <button
          pButton
          type="button"
          icon="pi pi-plus"
          class="p-button-rounded p-button-sm opacity-0 group-hover:opacity-100 transition-opacity duration-200"
          [disabled]="isDisabled()"
          [style]="{ 'background-color': '#00A9E0', 'border-color': '#00A9E0' }"
          (click)="startAdding()">
        </button>
      }
    </div>

    <!-- Add new reference form -->
    @if (isAdding()) {
      <div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Nueva Referencia (máx. 500 caracteres)
        </label>
        <textarea
          [(ngModel)]="newReference"
          class="w-full p-2 border border-gray-300 rounded-lg resize-none"
          rows="3"
          placeholder="Ingrese la referencia bibliográfica..."></textarea>
        <div class="flex justify-end gap-2 mt-2">
          <button
            pButton
            type="button"
            label="Cancelar"
            class="p-button-sm p-button-text"
            (click)="cancelAdding()">
          </button>
          <button
            pButton
            type="button"
            label="Agregar"
            icon="pi pi-check"
            class="p-button-sm"
            [disabled]="!newReference().trim()"
            (click)="onAddReference()">
          </button>
        </div>
      </div>
    }

    <!-- References list -->
    <div class="w-full">
      <div class="min-h-[40px] bg-white rounded-lg shadow w-full border border-gray-200 p-2">
        @if (references().length > 0) {
          <ul class="space-y-0">
            @for (reference of references(); track reference) {
              <li class="flex justify-between items-start gap-2 py-0.5 px-1 hover:bg-gray-50 rounded group">
                <div class="flex items-start flex-1 gap-1">
                  <span class="text-sm text-gray-700 flex-shrink-0">•</span>
                  <span class="text-sm text-gray-700 flex-1 break-words overflow-wrap-anywhere">{{ reference }}</span>
                </div>
                @if (!isReadOnly()) {
                  <button
                    pButton
                    type="button"
                    icon="pi pi-trash"
                    class="p-button-sm p-button-text p-button-danger opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0 ml-2"
                    (click)="onDeleteReference(reference)">
                  </button>
                }
              </li>
            }
          </ul>
        } @else {
          <p class="text-sm text-gray-500 italic">No hay referencias bibliográficas</p>
        }
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar referencia -->
<p-dialog 
  [(visible)]="showDeleteModal" 
  [modal]="true" 
  [closable]="true"
  [header]="'Eliminar referencia'"
  [style]="{ width: '90%', 'max-width': '600px' }"
  styleClass="delete-confirmation-modal"
  [draggable]="false"
  [resizable]="false"
  appendTo="body"
  [baseZIndex]="20000"
>
  <div class="p-6">
    <!-- Información explicativa -->
    <div class="info-box bg-white rounded-lg border-2 border-gray-300 p-4 mb-6">
      <div class="info-header mb-3">
        <div class="flex items-center gap-2 mb-2">
          <i class="pi pi-info-circle text-blue-500 text-xl"></i>
          <h3 class="info-title text-lg font-semibold text-gray-800">Información</h3>
        </div>
        <div class="info-separator"></div>
      </div>
      
      <div class="info-body text-sm text-gray-700">
        <p>Esta acción eliminará la referencia bibliográfica seleccionada.</p>
      </div>
    </div>

    <!-- Confirmación de eliminación -->
    <div class="selection-form bg-gray-50 rounded-lg p-4 border border-gray-200">
      <h4 class="text-sm font-semibold text-gray-700 mb-3">¿Confirmar eliminación?</h4>
      
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors"
          (click)="cancelDeleteReference()"
        >
          Cancelar
        </button>
        <button
          type="button"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors flex items-center gap-2"
          (click)="confirmDeleteReference()"
        >
          <i class="pi pi-trash mr-2"></i>
          Eliminar referencia
        </button>
      </div>
    </div>
  </div>
</p-dialog>
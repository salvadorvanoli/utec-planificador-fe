<p-toast position="top-right" />

<p-dialog
  [visible]="visible()"
  (visibleChange)="visible() !== $event && closeDialog()"
  [modal]="true"
  [header]="'Horarios de consulta'"
  [style]="{ width: '90%', 'max-width': '700px' }"
  styleClass="office-hours-modal"
  [draggable]="false"
  [resizable]="false"
  appendTo="body"
  [baseZIndex]="20000"
>
  <div class="p-6">
    <!-- Caja de tags con título "Agenda" -->
    <div class="schedule-box bg-white rounded-lg border-2 border-gray-300 p-4 mb-6">
      <div class="schedule-header mb-4">
        <h3 class="schedule-title text-lg font-semibold text-gray-800">Agenda</h3>
        <div class="schedule-separator"></div>
      </div>
      
      <div class="schedule-body">
        @if (isLoading()) {
          <div class="text-center py-4">
            <i class="pi pi-spinner pi-spin text-blue-500 text-2xl"></i>
          </div>
        } @else {
          <div class="tags-container flex flex-wrap gap-2">
            @for (schedule of formattedSchedules(); track schedule.id) {
              <span class="schedule-tag">
                {{ schedule.formatted }}
                <button 
                  class="remove-schedule-button"
                  (click)="removeSchedule(schedule)"
                  aria-label="Eliminar horario"
                  type="button"
                >
                  <i class="pi pi-times"></i>
                </button>
              </span>
            }
            @empty {
              <p class="text-gray-400 text-sm">No hay horarios de consulta disponibles</p>
            }
          </div>
        }
      </div>
    </div>

    <!-- Formulario para agregar horario -->
    <div class="add-schedule-form bg-gray-50 rounded-lg p-4 border border-gray-200">
      <h4 class="text-sm font-semibold text-gray-700 mb-3">Agregar nuevo horario</h4>
      
      <div class="grid sm:grid-cols-3 grid-cols-1 gap-3 mb-4">
        <!-- DatePicker -->
        <div>
          <app-datepicker
            id="select_date"
            [label]="'Fecha'"
            [(selectedDate)]="selectedDate"
            [dateFormat]="'dd/mm/yy'"
            [showOnFocus]="false"
          />
        </div>

        <!-- Hora de inicio -->
        <div class="w-full">
          <label for="start_time" class="block text-sm font-medium text-gray-700 mb-1.5">
            Hora inicio
          </label>
          <input
            pInputText
            type="time"
            id="start_time"
            [(ngModel)]="startTime"
            class="w-full time-input"
          />
        </div>

        <!-- Hora de fin -->
        <div class="w-full">
          <label for="end_time" class="block text-sm font-medium text-gray-700 mb-1.5">
            Hora fin
          </label>
          <input
            pInputText
            type="time"
            id="end_time"
            [(ngModel)]="endTime"
            class="w-full time-input"
          />
        </div>
      </div>

      <!-- Botón de agregar -->
      <div class="flex justify-end">
        <app-button
          [color]="'blue'"
          [label]="'Agregar horario'"
          (onClick)="addSchedule()"
        />
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end">
      <button
        type="button"
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors"
        (click)="closeDialog()"
      >
        Cerrar
      </button>
    </div>
  </ng-template>
</p-dialog>

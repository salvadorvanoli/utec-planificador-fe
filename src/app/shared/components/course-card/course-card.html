<div class="rectangle-9 flex flex-col sm:flex-row gap-4 sm:gap-5" 
     [class.no-pointer]="mode() === 'management'"
     [class.cursor-pointer]="mode() === 'info' || mode() === 'download'"
     [class.cursor-wait]="isGeneratingPdf()"
     (click)="handleCardClick()">
  @if (isLoading()) {
    <!-- Skeletons -->
    <!-- Columna izquierda -->
    <div class="flex flex-col gap-3 w-full sm:w-4/5">
      <!-- Título + badge shift -->
      <div class="flex gap-3 items-center">
        <p-skeleton width="40%" height="24px"></p-skeleton>
        <p-skeleton width="15%" height="20px" borderRadius="16px"></p-skeleton>
      </div>
      @if (assignState() == false) {
        <!-- Program + Term -->
        <div class="flex gap-4">
          <p-skeleton width="30%" height="18px"></p-skeleton>
          <p-skeleton width="25%" height="18px"></p-skeleton>
        </div>
        <!-- Rango de fechas -->
        <p-skeleton width="45%" height="18px"></p-skeleton>
        <!-- Docente -->
        <p-skeleton width="35%" height="18px"></p-skeleton>
        <!-- Última actualización -->
        <p-skeleton width="40%" height="16px"></p-skeleton>
      }
    </div>

    <!-- Columna derecha -->
    <div class="flex w-full sm:w-1/5 justify-center sm:justify-center items-center">
      @if (assignState() == false) {
        @if (isGeneratingPdf()) {
          <i class="pi pi-spin pi-spinner text-2xl text-primary"></i>
        } @else if (shouldShowPdfIcon()) {
          <p-skeleton width="24px" height="24px" shape="circle"></p-skeleton>
        }
      } @else {
        <p-skeleton width="20px" height="20px"></p-skeleton>
      }
    </div>
  } @else {
    <!-- Contenido cuando no está cargando -->
    <!-- Columna izquierda -->
    <div class="flex flex-col gap-2 w-full sm:w-4/5">
      <div class="flex flex-wrap items-center gap-2">
        <span class="card-title font-bold">
          {{ curricularUnitName() }}
        </span>
        @if (shift()) {
          <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
            {{ shift() }}
          </span>
        }
      </div>
      @if (programName() || termName()) {
        <div class="flex flex-wrap gap-2 text-sm text-gray-600">
          @if (programName()) {
            <span class="flex items-center gap-1">
              <i class="pi pi-book text-xs"></i>
              {{ programName() }}
            </span>
          }
          @if (termName()) {
            <span class="flex items-center gap-1">
              <i class="pi pi-calendar text-xs"></i>
              {{ termName() }}
            </span>
          }
        </div>
      }
      @if (dateRange()) {
        <span class="flex items-center gap-1 text-sm text-gray-600">
          <i class="pi pi-calendar-clock text-xs"></i>
          {{ dateRange() }}
        </span>
      }
      @if (assignState() == false && hasTeachers()) {
        <span class="card-professor-name text-gray-600">
          <i class="pi pi-user text-xs mr-1"></i>{{ teacherName() }}
        </span>
      }
      @if (assignState() == false) {
        <span class="card-last-update-date text-gray-500">
          <i class="pi pi-clock text-xs mr-1"></i>Última actualización: {{ formattedDate() }}
        </span>
      }
    </div>

    <!-- Columna derecha -->
    <div class="flex w-full sm:w-1/5 justify-center sm:items-center">
      @if (assignState() == false) {
        @if (mode() === 'management') {
          <div class="management-buttons" (click)="$event.stopPropagation()">
            <button 
              (click)="onEdit($event)"
              class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-200"
              title="Editar curso"
              aria-label="Editar curso">
              <i class="pi pi-pencil text-xl"></i>
            </button>
            <button 
              (click)="onDelete($event)"
              class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200"
              title="Eliminar curso"
              aria-label="Eliminar curso">
              <i class="pi pi-trash text-xl"></i>
            </button>
          </div>
        } @else if (isGeneratingPdf()) {
          <i class="pi pi-spin pi-spinner text-2xl text-primary" aria-label="Generando PDF"></i>
        } @else if (shouldShowPdfIcon()) {
          <i class="pi pi-file-pdf text-00A9E0-600 pdf-icon" aria-label="PDF"></i>
        }
      } @else {
        <p-checkbox [(ngModel)]="checked" [binary]="true" />
      }
    </div>
  }
</div>

<!-- Modal de confirmación de eliminación -->
<p-dialog 
  [(visible)]="showDeleteModal" 
  [modal]="true" 
  [closable]="true"
  [header]="'Eliminar curso'"
  [style]="{ width: '90%', 'max-width': '700px' }"
  styleClass="delete-confirmation-modal"
  [draggable]="false"
  [resizable]="false"
  appendTo="body"
  [baseZIndex]="20000"
>
  <div class="p-6">
    <!-- Información explicativa -->
    <div class="info-box bg-white rounded-lg border-2 border-gray-300 p-4 mb-6">
      <div class="info-header mb-3">
        <div class="flex items-center gap-2 mb-2">
          <i class="pi pi-info-circle text-blue-500 text-xl"></i>
          <h3 class="info-title text-lg font-semibold text-gray-800">Información</h3>
        </div>
        <div class="info-separator"></div>
      </div>
      
      <div class="info-body text-sm text-gray-700 space-y-2">
        <p>Esta acción eliminará permanentemente el curso seleccionado.</p>
        <div class="flex items-start gap-2 mt-3 p-3 bg-orange-50 border border-orange-200 rounded">
          <i class="pi pi-exclamation-triangle text-orange-500 flex-shrink-0 mt-0.5"></i>
          <p class="text-sm">
            <span class="font-semibold">Advertencia:</span> Esta acción no se puede deshacer. Se perderá toda la planificación del curso, incluyendo contenidos programáticos y actividades.
          </p>
        </div>
      </div>
    </div>

    <!-- Confirmación de eliminación -->
    <div class="selection-form bg-gray-50 rounded-lg p-4 border border-gray-200">
      <h4 class="text-sm font-semibold text-gray-700 mb-3">¿Confirmar eliminación?</h4>
      
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="cancelDelete()"
          [disabled]="isDeletingCourse()"
        >
          Cancelar
        </button>
        <button
          type="button"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="confirmDelete()"
          [disabled]="isDeletingCourse()"
        >
          <i [class]="isDeletingCourse() ? 'pi pi-spinner pi-spin mr-2' : 'pi pi-trash mr-2'"></i>
          {{ isDeletingCourse() ? 'Eliminando...' : 'Eliminar curso' }}
        </button>
      </div>
    </div>
  </div>
</p-dialog>

<!-- Toast para mensajes -->
<p-toast></p-toast>

<!-- Confirm Dialog para confirmaciones -->
<p-confirmDialog></p-confirmDialog>